(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{129:function(e,t,s){"use strict";s.r(t);var n=s(0),a=(s(68),s(69),s(70),s(71),s(1)),r=s(22),c=s.n(r),o=s(2),i=s(3),l=s(4),u=s.n(l),d=s(8),j=s(135),m=(s(76),["user001","user002","user003","user004"]);function b(e){var t=e.onLogIn,s=Object(a.useState)((function(){return m[0]})),r=Object(i.a)(s,2),c=r[0],o=r[1],l=Object(a.useState)(null),b=Object(i.a)(l,2),O=b[0],h=b[1],p=function(){var e=Object(d.a)(u.a.mark((function e(s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.preventDefault(),t(c,h);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("div",{className:"login-form text-center login-page",children:Object(n.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(n.jsx)("div",{className:"position-relative",children:Object(n.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"rgba(85, 110, 230, 0.25)",paddingLeft:20,paddingRight:20,borderTopLeftRadius:4,borderTopRightRadius:4},children:[Object(n.jsx)("div",{className:"col text-primary text-left",children:Object(n.jsx)("h3",{className:"font-size-15",children:"Sign in"})}),Object(n.jsx)("div",{className:"col align-self-end"})]})}),Object(n.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:58,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:p,children:[Object(n.jsx)("label",{className:"font-size-12",children:"Name"}),Object(n.jsx)("div",{className:"username-select mb-3",children:Object(n.jsx)(f,{username:c,setUsername:o,names:m})}),Object(n.jsx)("div",{style:{height:30}}),Object(n.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(n.jsx)("div",{className:"login-error-anchor",children:Object(n.jsx)("div",{className:"toast-box",children:Object(n.jsxs)(j.a,{style:{minWidth:277},onClose:function(){return h(null)},show:null!==O,delay:3e3,autohide:!0,children:[Object(n.jsxs)(j.a.Header,{children:[Object(n.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(n.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(n.jsx)(j.a.Body,{children:O})]})})}),Object(n.jsx)("div",{style:{height:30}})]})]})})})}var f=function(e){var t,s=e.username,r=e.setUsername,c=e.names,o=void 0===c?[""]:c,l=Object(a.useState)(!1),u=Object(i.a)(l,2),d=u[0],j=u[1],m=Object(a.useState)(0),b=Object(i.a)(m,2),f=b[0],O=b[1],h=Object(a.useRef)(),p=null===(t=h.current)||void 0===t?void 0:t.getBoundingClientRect().width;return Object(a.useEffect)((function(){O(p)}),[p]),Object(a.useEffect)((function(){if(d){var e=function(){return j(!1)};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}}),[d]),Object(a.useEffect)((function(){var e;d&&(null===(e=h.current)||void 0===e||e.focus())}),[d]),Object(n.jsxs)("div",{tabIndex:0,ref:h,className:"username-select-dropdown ".concat(d?"open":""),onClick:function(){return j((function(e){return!e}))},children:[Object(n.jsxs)("div",{className:"username-select-row",children:[Object(n.jsx)("div",{children:s}),Object(n.jsx)("div",{children:Object(n.jsx)("svg",{width:24,height:24,children:Object(n.jsx)("path",{d:"M7 10l5 5 5-5z",fill:"#333"})})})]}),Object(n.jsx)("div",{style:{width:f},className:"username-select-block ".concat(d?"open":""),children:o.map((function(e){return Object(n.jsx)("div",{className:"username-select-block-item",onClick:function(){return r(e)},children:e},e)}))})]})},O=s(18),h=(s(79),s(12)),p=function(e,t){switch(t.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),{},Object(h.a)({},t.payload.id,t.payload))});case"make user online":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),{},Object(h.a)({},t.payload,Object(o.a)(Object(o.a)({},e.users[t.payload]),{},{online:!0})))});case"append users":return Object(o.a)(Object(o.a)({},e),{},{users:Object(o.a)(Object(o.a)({},e.users),t.payload)});case"set messages":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(h.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{messages:t.payload.messages,offset:t.payload.messages.length})))});case"prepend messages":var s=[].concat(Object(O.a)(t.payload.messages),Object(O.a)(e.rooms[t.payload.id].messages));return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(h.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{messages:s,offset:s.length})))});case"append message":return void 0===e.rooms[t.payload.id]?e:Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(h.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.message,messages:e.rooms[t.payload.id].messages?[].concat(Object(O.a)(e.rooms[t.payload.id].messages),[t.payload.message]):void 0})))});case"set last message":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(h.a)({},t.payload.id,Object(o.a)(Object(o.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.lastMessage})))});case"set current room":return Object(o.a)(Object(o.a)({},e),{},{currentRoom:t.payload});case"add room":return Object(o.a)(Object(o.a)({},e),{},{rooms:Object(o.a)(Object(o.a)({},e.rooms),{},Object(h.a)({},t.payload.id,t.payload))});case"set rooms":var n=t.payload,a=Object(o.a)({},e.rooms);return n.forEach((function(e){a[e.id]=Object(o.a)(Object(o.a)({},e),{},{messages:a[e.id]&&a[e.id].messages})})),Object(o.a)(Object(o.a)({},e),{},{rooms:a});default:return e}},g={currentRoom:"main",rooms:{},users:{}},x=Object(a.createContext)(),v=function(){var e=Object(a.useContext)(x),t=Object(i.a)(e,2);return[t[0],t[1]]},y=function(){return Object(a.useReducer)(p,g)},N=s(17),w=s.n(N),k=s(10),L=s.n(k);L.a.defaults.withCredentials=!0;var M=function(e){return"".concat("").concat(e)},C=function(){return L.a.get(M("/me")).then((function(e){return e.data})).catch((function(e){return null}))},E=function(e,t){return L.a.post(M("/login"),{username:e,password:t}).then((function(e){return e.data})).catch((function(e){throw new Error(e.response&&e.response.data&&e.response.data.message)}))},S=function(){return L.a.post(M("/logout"))},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return L.a.get(M("/room/".concat(e,"/messages")),{params:{offset:t,size:s}}).then((function(e){return e.data.reverse()}))},I=function(e){return L.a.get(M("/users"),{params:{ids:e}}).then((function(e){return e.data}))},z=function(){var e=Object(d.a)(u.a.mark((function e(t,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",L.a.post(M("/room"),{user1:t,user2:s}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}(),_=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",L.a.get(M("/rooms/".concat(t))).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(e){var t=e.id,s=e.name,n=v(),r=Object(i.a)(n,1)[0],c=Object(a.useMemo)((function(){try{var e=Math.abs(parseInt(t.split(":").reverse().pop())),n=e>0,a=Object.entries(r.users).filter((function(e){return Object(i.a)(e,2)[1].username===s})).map((function(e){return Object(i.a)(e,2)[1]}));return a.length>0&&(e=+a[0].id),[n,e]}catch(c){return[!1,!1,"0"]}}),[t,s,r.users]),o=Object(i.a)(c,2),l=o[0],u=o[1],d=B(e);return{isUser:l,userId:u,name:e.name,lastMessage:d}},B=function(e){var t=v(),s=Object(i.a)(t,2)[1],n=e.lastMessage;return Object(a.useEffect)((function(){void 0===n&&(void 0===e.messages?R(e.id,0,1).then((function(t){var n=null;0!==t.length&&(n=t.pop()),s({type:"set last message",payload:{id:e.id,lastMessage:n}})})):0===e.messages.length?s({type:"set last message",payload:{id:e.id,lastMessage:null}}):s({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[n,s,e]),n},U=function(e){var t=e.room,s=e.active,a=void 0!==s&&s,r=e.onClick,c=T(t),o=c.name,i=c.lastMessage;return Object(n.jsxs)("div",{onClick:r,className:"chat-list-item d-flex align-items-start rounded ".concat(a?"bg-white":""),children:[Object(n.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(n.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:o}),i&&Object(n.jsxs)("p",{className:"text-truncate mb-0",children:[" ",i.message," "]})]}),i&&Object(n.jsx)("div",{className:"font-size-11",children:w.a.unix(i.date).format("LT")})]})},F=s(133),H=function(e){var t=e.onLogOut,s=e.col,a=void 0===s?5:s,r=e.noinfo,c=void 0!==r&&r;return Object(n.jsxs)("div",{onClick:t,style:{cursor:"pointer"},className:"col-".concat(a," text-danger ").concat(c?"":"text-right"),children:[Object(n.jsx)(F.a,{})," Log out"]})},D=function(e){e.user;var t=e.col,s=void 0===t?7:t,a=e.noinfo,r=void 0!==a&&a;return Object(n.jsx)("div",{className:"col-".concat(s," d-flex align-items-center ").concat(r?"justify-content-end":"")})},W=function(e){var t=e.user,s=e.onLogOut;return Object(n.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(D,{user:t,col:8}),Object(n.jsx)(H,{onLogOut:s,col:4})]})})},J=function(e){var t=e.rooms,s=e.dispatch,r=e.user,c=e.currentRoom,o=e.onLogOut,i=Object(a.useMemo)((function(){var e=Object.values(t),s=e.filter((function(e){return"0"===e.id})),n=e.filter((function(e){return"0"!==e.id}));return n=n.sort((function(e,t){return+e.id.split(":").pop()-+t.id.split(":").pop()})),[].concat(Object(O.a)(s||[]),Object(O.a)(n))}),[t]);return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(n.jsx)("div",{className:"py-2",children:Object(n.jsx)("p",{className:"h5 mb-0 py-1 chats-title",children:"Chats"})}),Object(n.jsx)("div",{className:"messages-box flex flex-1",children:Object(n.jsx)("div",{className:"list-group rounded-0",children:i.map((function(e){return Object(n.jsx)(U,{onClick:function(){return s({type:"set current room",payload:e.id})},active:c===e.id,room:e},e.id)}))})}),Object(n.jsx)(W,{user:r,onLogOut:o})]})})},V=function(e){var t=e.message;return Object(n.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:t})},P=function(){return Object(n.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(n.jsx)("div",{className:"spinner-border",role:"status",children:Object(n.jsx)("span",{className:"visually-hidden"})})})},q=s(134),A=function(){return Object(n.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(n.jsx)(q.a,{size:96}),Object(n.jsx)("p",{children:"No messages"})]})},G=function(){return Object(n.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]})},K=function(e){var t=e.username,s=void 0===t?"user":t,a=e.message,r=void 0===a?"Lorem ipsum dolor...":a,c=e.date;return Object(n.jsxs)("div",{className:"d-flex",children:[Object(n.jsx)("div",{style:{flex:1}}),Object(n.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(n.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(n.jsxs)("div",{className:"ctext-wrap",children:[Object(n.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:s}),Object(n.jsx)("p",{className:"text-left",children:r}),Object(n.jsxs)("p",{className:"chat-time mb-0",children:[Object(n.jsx)(G,{})," ",w.a.unix(c).format("LT")," "]})]})})})]})},Q=function(e){var t=e.user,s=e.message,a=void 0===s?"Lorem ipsum dolor...":s,r=e.date,c=e.onUserClicked;return Object(n.jsxs)("div",{className:"d-flex",children:[Object(n.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(n.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(n.jsxs)("div",{className:"ctext-wrap",children:[t&&Object(n.jsx)("div",{className:"conversation-name text-primary d-flex align-items-center mb-1",children:Object(n.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer"},onClick:c,children:t.username})}),Object(n.jsx)("p",{className:"text-left",children:a}),Object(n.jsxs)("p",{className:"chat-time mb-0",children:[Object(n.jsx)(G,{})," ",w.a.unix(r).format("LT")," "]})]})})}),Object(n.jsx)("div",{style:{flex:1}})]})},X=function(e){var t=e.messageListElement,s=e.messages,a=e.room,r=e.onLoadMoreMessages,c=e.user,o=e.onUserClicked,i=e.users;return Object(n.jsxs)("div",{ref:t,className:"chat-box-wrapper position-relative d-flex",children:[void 0===s?Object(n.jsx)(P,{}):0===s.length?Object(n.jsx)(A,{}):Object(n.jsx)(n.Fragment,{}),Object(n.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:s&&0!==s.length&&Object(n.jsxs)(n.Fragment,{children:[a.offset&&a.offset>=15?Object(n.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(n.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(n.jsx)("div",{className:"mx-3",children:Object(n.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:r,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(n.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(n.jsx)(n.Fragment,{}),s.map((function(e,t){var s=e.message+e.date+e.from+t;return"info"===e.from?Object(n.jsx)(V,{message:e.message},s):+e.from!==+c.id?Object(n.jsx)(Q,{onUserClicked:function(){return o(e.from)},message:e.message,date:e.date,user:i[e.from]},s):Object(n.jsx)(K,{username:i[e.from]?i[e.from].username:"",message:e.message,date:e.date},s)}))]})})]})},Y=function(e){var t=e.message,s=e.setMessage,a=e.onSubmit;return Object(n.jsx)("div",{className:"p-3 chat-input-section",children:Object(n.jsxs)("form",{className:"row",onSubmit:a,children:[Object(n.jsx)("div",{className:"col",children:Object(n.jsx)("div",{className:"position-relative",children:Object(n.jsx)("input",{value:t,onChange:function(e){return s(e.target.value)},type:"text",placeholder:"Enter Message...",className:"form-control chat-input"})})}),Object(n.jsx)("div",{className:"col-auto",children:Object(n.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(n.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(n.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(n.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})},Z=s(63),$=function(e,t){var s,n=Object(Z.a)(e);try{for(n.s();!(s=n.n()).done;){var a=s.value;if("string"!==typeof a&&(a=a[0]),a!==t)return a}}catch(r){n.e(r)}finally{n.f()}return e[0]},ee=(s(130),function(){var e=Object(d.a)(u.a.mark((function e(t,s,n){var a,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},n.forEach((function(e){a[e.from]=1})),0===(r=Object.keys(a).filter((function(e){return void 0===t[e]}))).length){e.next=8;break}return e.next=6,I(r);case 6:c=e.sent,s({type:"append users",payload:c});case 8:case"end":return e.stop()}}),e)})));return function(t,s,n){return e.apply(this,arguments)}}()),te=function(e){var t=v(),s=Object(i.a)(t,2),n=s[0],r=s[1],c=Object(a.useRef)(null),l=n.rooms[n.currentRoom],j=null===l||void 0===l?void 0:l.id,m=null===l||void 0===l?void 0:l.messages,b=Object(a.useState)(""),f=Object(i.a)(b,2),O=f[0],h=f[1],p=Object(a.useCallback)((function(){setTimeout((function(){c.current&&(c.current.scrollTop=0)}),0)}),[]),g=Object(a.useCallback)((function(){c.current&&c.current.scrollTo({top:c.current.scrollHeight})}),[]);Object(a.useEffect)((function(){g()}),[m,g]);var x=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R(j,e).then(function(){var e=Object(d.a)(u.a.mark((function e(s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(n.users,r,s);case 2:r({type:t?"prepend messages":"set messages",payload:{id:j,messages:s}}),t?setTimeout((function(){p()}),10):g();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[r,j,g,p,n.users]);Object(a.useEffect)((function(){void 0!==j&&void 0===m&&x()}),[m,r,j,n.users,n,g,x]),Object(a.useEffect)((function(){c.current&&g()}),[g,j]);var y=function(){var t=Object(d.a)(u.a.mark((function t(s){var a,c,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.users[s],void 0!==(c=a.room)){t.next=9;break}return t.next=5,z(s,e.id);case 5:i=t.sent,c=i.id,r({type:"set user",payload:Object(o.a)(Object(o.a)({},a),{},{room:c})}),r({type:"add room",payload:{id:c,name:$(i.names,e.username)}});case 9:r({type:"set current room",payload:c});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{onLoadMoreMessages:Object(a.useCallback)((function(){x(l.offset,!0)}),[x,l]),onUserClicked:y,message:O,setMessage:h,dispatch:r,room:l,rooms:n.rooms,currentRoom:n.currentRoom,messageListElement:c,roomId:j,users:n.users,messages:m}};function se(e){var t=e.onLogOut,s=e.user,a=e.onMessageSend,r=te(s),c=r.onLoadMoreMessages,o=r.onUserClicked,i=r.message,l=r.setMessage,u=r.rooms,d=r.room,j=r.currentRoom,m=r.dispatch,b=r.messageListElement,f=r.roomId,O=r.messages,h=r.users;return Object(n.jsx)("div",{className:"container py-5 px-4",children:Object(n.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(n.jsx)("div",{className:"col-4 px-0 chat-list-box",children:Object(n.jsx)(J,{user:s,onLogOut:t,rooms:u,currentRoom:j,dispatch:m})}),Object(n.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(n.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid #eee"},children:Object(n.jsx)("h2",{className:"font-size-15 mb-0",children:d?d.name:"Room"})}),Object(n.jsx)(X,{messageListElement:b,messages:O,room:d,onLoadMoreMessages:c,user:s,onUserClicked:o,users:h}),Object(n.jsx)(Y,{message:i,setMessage:l,onSubmit:function(e){e.preventDefault(),a(i.trim(),f),l(""),b.current.scrollTop=b.current.scrollHeight}})]})]})})}function ne(){return Object(n.jsx)("div",{className:"centered-box",children:Object(n.jsx)("div",{className:"spinner-border",role:"status",children:Object(n.jsx)("span",{className:"visually-hidden"})})})}var ae=s(64),re=s.n(ae),ce=function(){var e=y(),t=Object(i.a)(e,2),s=t[0],n=t[1],r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){},t=arguments.length>1?arguments[1]:void 0,s=Object(a.useState)(!0),n=Object(i.a)(s,2),r=n[0],c=n[1],o=Object(a.useState)(null),l=Object(i.a)(o,2),j=l[0],m=l[1],b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};s(null),n(!0),E(e,t).then((function(e){m(e)})).catch((function(e){return s(e.message)})).finally((function(){return n(!1)}))},f=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S().then((function(){m(null),t({type:"clear"}),c(!0)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){r&&C().then((function(t){m(t),c(!1),e(t)}))}),[e,r]),{user:j,onLogIn:b,onLogOut:f,loading:r}}(Object(a.useCallback)((function(e){null!==e&&(s.users[e.id]||n({type:"set user",payload:Object(o.a)(Object(o.a)({},e),{},{online:!0})}))}),[n,s.users]),n),c=r.user,l=r.onLogIn,j=r.onLogOut,m=r.loading,b=function(e,t){var s=Object(a.useState)(!1),n=Object(i.a)(s,2),r=n[0],c=n[1],o=Object(a.useRef)(null),l=o.current;return Object(a.useEffect)((function(){null===e?(null!==l&&l.disconnect(),c(!1)):(null!==l?l.connect():o.current=re()(),c(!0))}),[e,l]),Object(a.useEffect)((function(){r&&e?(l.on("show.room",(function(s){console.log({user:e}),t({type:"add room",payload:{id:s.id,name:$(s.names,e.username)}})})),l.on("message",(function(e){t({type:"make user online",payload:e.from}),t({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})}))):l&&(l.off("user.room"),l.off("message"))}),[r,e,t,l]),[l,r]}(c,n),f=Object(i.a)(b,2),O=f[0],h=f[1];Object(a.useEffect)((function(){if(null!==c)if(h){var e=[];Object.keys(s.rooms).forEach((function(t){var n=s.rooms[t];n.connected||(e.push(Object(o.a)(Object(o.a)({},n),{},{connected:!0})),O.emit("room.join",n.id))})),0!==e.length&&n({type:"set rooms",payload:e})}else{var t=[];Object.keys(s.rooms).forEach((function(e){var n=s.rooms[e];n.connected&&t.push(Object(o.a)(Object(o.a)({},n),{},{connected:!1}))})),0!==t.length&&n({type:"set rooms",payload:t})}}),[c,h,n,O,s.rooms,s.users]),Object(a.useEffect)((function(){0===Object.values(s.rooms).length&&null!==c&&_(c.id).then((function(e){var t=[];e.forEach((function(e){var s=e.id,n=e.names;t.push({id:s,name:$(n,c.username)})})),n({type:"set rooms",payload:t}),n({type:"set current room",payload:"0"})}))}),[n,s.rooms,c]);var p=Object(a.useCallback)((function(e,t){"string"===typeof e&&0!==e.trim().length&&(O||console.error("Couldn't send message"),O.emit("message",{roomId:t,message:e,from:c.id,date:w()(new Date).unix()}))}),[c,O]);return{loading:m,user:c,state:s,dispatch:n,onLogIn:l,onMessageSend:p,onLogOut:j}},oe=function(){var e=ce(),t=e.loading,s=e.user,a=e.state,r=e.dispatch,c=e.onLogIn,o=e.onMessageSend,i=e.onLogOut;if(t)return Object(n.jsx)(ne,{});var l=!s;return Object(n.jsx)(x.Provider,{value:[a,r],children:Object(n.jsx)("div",{className:"full-height ".concat(l?"bg-light":""),style:{backgroundColor:l?void 0:"#495057"},children:l?Object(n.jsx)(b,{onLogIn:c}):Object(n.jsx)(se,{user:s,onMessageSend:o,onLogOut:i})})})};c.a.render(Object(n.jsx)(oe,{}),document.getElementById("root"))},69:function(e,t,s){},70:function(e,t,s){},71:function(e,t,s){},76:function(e,t,s){},79:function(e,t,s){}},[[129,1,2]]]);
//# sourceMappingURL=main.1d6c0c3c.chunk.js.map